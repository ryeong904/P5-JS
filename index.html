<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js"></script>
    <!-- <script src="./p5.sound.js"></script> -->
    <link rel="stylesheet" href="index.css">
    <title>BullMung</title>
</head>
<body>
    <script>
        let system;
        let circle_x, circle_y;
        // let song;

        //크롬 정책 문제로 사운드 autoplay 불가능.
        // function preload() {
        //     song = loadSound('./resource/모닥불소리.mp3');
        // }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            background('black')
            // song.play();
            system = new ParticleSystem(createVector(width / 2, 590))
            circle_x = 40;
            circle_y = 40;
        }

        
        function draw() {
            background('black');
            system.addParticle();
            system.run(circle_x,circle_y);

            if (mouseIsPressed === true) {
                if (circle_x <= 50 && circle_y <= 50){
                    circle_x = circle_x + 0.5;
                    circle_y = circle_y + 0.5;
                }
            } else{
                if (circle_x >= 40 && circle_y >= 40){
                    circle_x = circle_x - 0.5;
                    circle_y = circle_y - 0.5;
                }
            }
        }

        // function mousePressed() {
        //     if (song.isPlaying()) {
        //         song.stop();
        //     }else{
        //         song.play();
        //     }
        // }

        //별 밤하늘에 뿌리기
        function makeSnow(){
            fill('white')
            noStroke();
            
            for(let i = 0 ; i < 40; i++){
                let w = random(windowWidth)
                let h = random(550)
                star(w,h, 3, 1, 5);
            }
        }

        function star(x, y, radius1, radius2, npoints) {
            let angle = TWO_PI / npoints;
            let halfAngle = angle / 2.0;
            beginShape();
            for (let a = 0; a < TWO_PI; a += angle) {
                let sx = x + cos(a) * radius2;
                let sy = y + sin(a) * radius2;
                vertex(sx, sy);
                sx = x + cos(a + halfAngle) * radius1;
                sy = y + sin(a + halfAngle) * radius1;
                vertex(sx, sy);
            }
            endShape(CLOSE);
        }
        
        //파티클 클래스
        //가속도, 속도, 위치, 생명주기
        let Particle = function(position) {
            this.acceleration = createVector(0, -0.05);
            this.velocity = createVector(random(-1,1), random(-1,1));
            this.position = position.copy();
            this.lifespan = 270;
        }

        Particle.prototype.run = function(a,b) {
            this.update();
            this.display(a,b);
        }

        Particle.prototype.update = function() {
            this.velocity.add(this.acceleration);
            this.position.add(this.velocity);
            this.lifespan -= 2;
        }

        Particle.prototype.display = function(a,b) {
            stroke(300, this.lifespan);
            noStroke();
            fill(this.lifespan-80, 0, 0);
            ellipse(this.position.x, this.position.y, a,b);
        }

        Particle.prototype.isDead = function() {
            return this.lifespan < 0;
        }

        let ParticleSystem = function(position) {
            this.origin = position.copy();
            this.particles = [];
        }

        ParticleSystem.prototype.addParticle = function() {
            this.particles.push(new Particle(this.origin));
        }

        ParticleSystem.prototype.run = function(a,b) {
            for(let i = this.particles.length-1; i>=0; i--){
                    let p = this.particles[i];
                    p.run(a,b);
                    if(p.isDead()){
                        this.particles.splice(i,1);
                    }
                }
        }


    </script>
</body>
</html>