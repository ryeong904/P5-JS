<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js"></script>
    <link rel="stylesheet" href="index.css">
    <title>BullMung</title>
</head>
<body>
    <script>
        let system;

        function setup() {
            //밤하늘
            createCanvas(windowWidth, windowHeight);
            background('black')
            // // frameRate(3)

            //잔디 표현 
            fill(0, 97, 13)
            rect(0, 700,windowWidth, windowHeight)
            makeSnow()
            //장작
            stroke(10)
            push();
            fill(139,69,19);
            translate(windowWidth/2-30, 680);
            rotate(1.4);
            rect(0, 0, 40, 100, 7);
            pop();
            
            push();
            fill(139,69,19);
            translate(windowWidth/2, 680);
            rotate(0.9);
            rect(0, 0, 40, 100, 7);
            pop();

            push();
            fill(139,69,19);
            translate(windowWidth/2, 710);
            rotate(-0.9);
            rect(0, 0, 40, 100, 7);
            pop();

            push();
            fill(139,69,19);
            translate(windowWidth/2+50,720);
            rotate(-1.4);
            rect(0, 0, 40, 100, 7);
            pop();

            system = new ParticleSystem(createVector(windowWidth/2+10, 710))

        }

        function draw() {
            // background(100);
            system.addParticle();
            system.run();
        }
        // circle(random(windowWidth), random(550), 5)
        
        //별 밤하늘에 뿌리기
        function makeSnow(){
            fill('white')
            noStroke();
            
            for(let i = 0 ; i < 40; i++){
                let w = random(windowWidth)
                let h = random(550)
                star(w,h, 3, 1, 5);
            }
        }

        function star(x, y, radius1, radius2, npoints) {
            let angle = TWO_PI / npoints;
            let halfAngle = angle / 2.0;
            beginShape();
            for (let a = 0; a < TWO_PI; a += angle) {
                let sx = x + cos(a) * radius2;
                let sy = y + sin(a) * radius2;
                vertex(sx, sy);
                sx = x + cos(a + halfAngle) * radius1;
                sy = y + sin(a + halfAngle) * radius1;
                vertex(sx, sy);
            }
            endShape(CLOSE);
        }
        
        //파티클 클래스
        //가속도, 속도, 위치, 생명주기
        let Particle = function(position) {
            this.acceleration = createVector(0, -0.05);
            this.velocity = createVector(random(-1,1), random(-1,1));
            this.position = position.copy();
            this.lifespan = 270;
        }

        Particle.prototype.run = function() {
            this.update();
            this.display();
        }

        Particle.prototype.update = function() {
            this.velocity.add(this.acceleration);
            this.position.add(this.velocity);
            this.lifespan -= 2;
        }

        Particle.prototype.display = function() {
            stroke(300, this.lifespan);
            noStroke();
            fill(this.lifespan-80, 0, 0);
            ellipse(this.position.x, this.position.y, 40,40);
        }

        Particle.prototype.isDead = function() {
            return this.lifespan < 0;
        }

        let ParticleSystem = function(position) {
            this.origin = position.copy();
            this.particles = [];
        }

        ParticleSystem.prototype.addParticle = function() {
            this.particles.push(new Particle(this.origin));
        }

        ParticleSystem.prototype.run = function() {
            for(let i = this.particles.length-1; i>=0; i--){
                    let p = this.particles[i];
                    p.run();
                    if(p.isDead()){
                        this.particles.splice(i,1);
                    }
                }
        }


    </script>
</body>
</html>